<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VEX AI - Powered by Groq</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Reset and Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #8b5cf6;
            --primary-light: #a78bfa;
            --primary-dark: #7c3aed;
            --secondary: #06b6d4;
            --accent: #3b82f6;
            
            /* Dark Theme Variables */
            --dark-background: #0a0f1a;
            --dark-foreground: #f8fafc;
            --dark-card-bg: #1e293b;
            --dark-border-color: #1e293b;
            --dark-muted-text: #94a3b8;
            --dark-sidebar-bg: rgba(10, 15, 26, 0.9);
            --dark-input-bg: rgba(30, 41, 59, 0.5);
            
            /* Light Theme Variables */
            --light-background: #f8fafc;
            --light-foreground: #1e293b;
            --light-card-bg: #ffffff;
            --light-border-color: #e2e8f0;
            --light-muted-text: #64748b;
            --light-sidebar-bg: rgba(248, 250, 252, 0.95);
            --light-input-bg: rgba(241, 245, 249, 0.8);
            
            /* Active Theme Variables (will be set by JS) */
            --background: var(--dark-background);
            --foreground: var(--dark-foreground);
            --card-bg: var(--dark-card-bg);
            --border-color: var(--dark-border-color);
            --muted-text: var(--dark-muted-text);
            --sidebar-bg: var(--dark-sidebar-bg);
            --input-bg: var(--dark-input-bg);
            
            /* Layout Variables */
            --sidebar-width: 280px;
            --sidebar-collapsed-width: 0px;
            --transition-speed: 0.3s;
        }

        body {
            background-color: var(--background);
            color: var(--foreground);
            height: 100vh;
            overflow: hidden;
            display: flex;
        }

        /* Aurora Background Effect - Enhanced */
        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 20%, rgba(139, 92, 246, 0.15), transparent 40%),
                radial-gradient(circle at 80% 20%, rgba(6, 182, 212, 0.1), transparent 40%),
                radial-gradient(circle at 50% 80%, rgba(59, 130, 246, 0.1), transparent 40%),
                radial-gradient(circle at 30% 50%, rgba(124, 58, 237, 0.08), transparent 35%);
            background-size: 200% 200%;
            animation: aurora 15s ease infinite;
            pointer-events: none;
            z-index: -1;
            opacity: var(--aurora-opacity, 1);
        }

        @keyframes aurora {
            0% { background-position: 0% 0%; }
            50% { background-position: 100% 100%; }
            100% { background-position: 0% 0%; }
        }

        /* Sidebar Styles */
        .sidebar {
            width: var(--sidebar-width);
            height: 100vh;
            background-color: var(--sidebar-bg);
            border-right: 1px solid var(--border-color);
            transition: width var(--transition-speed) ease;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            backdrop-filter: blur(10px);
            position: relative;
            z-index: 10;
        }

        .sidebar.collapsed {
            width: var(--sidebar-collapsed-width);
        }

        .sidebar-header {
            padding: 20px;
            display: flex;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
        }

        .logo {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 15px;
            object-fit: cover;
        }

        .app-title {
            font-size: 1.5rem;
            font-weight: bold;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .sidebar-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .sidebar-footer {
            padding: 20px;
            border-top: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(10, 15, 26, 0.3);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(to bottom, var(--primary), var(--secondary));
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(to bottom, var(--primary-dark), var(--accent));
        }

        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            height: 100vh;
            position: relative;
            overflow: hidden;
        }

        .chat-header {
            padding: 15px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid var(--border-color);
            background-color: var(--sidebar-bg);
            backdrop-filter: blur(10px);
        }

        .header-left {
            display: flex;
            align-items: center;
        }

        .header-right {
            display: flex;
            align-items: center;
        }

        .toggle-sidebar {
            background: none;
            border: none;
            color: var(--foreground);
            font-size: 1.2rem;
            cursor: pointer;
            margin-right: 15px;
            transition: transform 0.3s ease;
        }

        .toggle-sidebar:hover {
            color: var(--primary);
        }

        .chat-title {
            font-size: 1.2rem;
            font-weight: 500;
        }

        .chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        .welcome-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 20px;
        }

        .welcome-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin-bottom: 30px;
            object-fit: cover;
            border: 3px solid transparent;
            background: linear-gradient(var(--background), var(--background)) padding-box,
                        linear-gradient(to right, var(--primary), var(--secondary)) border-box;
            box-shadow: 0 0 30px rgba(139, 92, 246, 0.3);
            animation: pulse 3s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 30px rgba(139, 92, 246, 0.3); }
            50% { box-shadow: 0 0 40px rgba(139, 92, 246, 0.5); }
            100% { box-shadow: 0 0 30px rgba(139, 92, 246, 0.3); }
        }

        .welcome-gradient {
            padding: 40px;
            border-radius: 16px;
            position: relative;
            overflow: hidden;
            max-width: 600px;
            width: 100%;
            background-color: var(--card-bg);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .welcome-gradient::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, 
                rgba(139, 92, 246, 0.1), 
                rgba(6, 182, 212, 0.1), 
                rgba(59, 130, 246, 0.1));
            filter: blur(20px);
            border-radius: 16px;
            z-index: -1;
            opacity: 0.7;
            transition: all 0.5s ease;
        }

        .welcome-gradient:hover::before {
            background-position: 100% 100%;
            opacity: 1;
        }

        .welcome-title {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 20px;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            animation: gradient-shift 5s ease infinite;
        }

        @keyframes gradient-shift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .welcome-subtitle {
            font-size: 1.2rem;
            margin-bottom: 20px;
            color: var(--foreground);
        }

        .welcome-text {
            color: var(--muted-text);
        }

        .powered-by {
            margin-top: 30px;
            font-size: 0.9rem;
            color: var(--muted-text);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .powered-by i {
            margin-right: 8px;
            color: var(--primary);
        }

        .message {
            display: flex;
            margin-bottom: 20px;
            max-width: 80%;
            animation: fade-in 0.3s ease;
        }

        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.user {
            margin-left: auto;
            flex-direction: row-reverse;
        }

        .message.ai {
            margin-right: auto;
        }

        .message.system {
            margin: 20px auto;
            max-width: 90%;
        }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin: 0 10px;
            object-fit: cover;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--card-bg);
            color: var(--primary);
            font-size: 1.5rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .avatar img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
        }

        .message-bubble {
            padding: 12px 16px;
            border-radius: 18px;
            position: relative;
            white-space: pre-wrap;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .user .message-bubble {
            background: linear-gradient(to right, var(--primary), var(--primary-dark));
            color: white;
            border-top-right-radius: 4px;
        }

        .ai .message-bubble {
            background-color: var(--card-bg);
            color: var(--foreground);
            border-top-left-radius: 4px;
        }

        .system .message-bubble {
            background-color: rgba(139, 92, 246, 0.1);
            color: var(--foreground);
            border-radius: 12px;
            text-align: center;
            border: 1px dashed var(--primary-light);
        }

        .typing-indicator {
            display: flex;
            align-items: center;
            margin-right: auto;
            margin-bottom: 20px;
            max-width: 80%;
        }

        .typing-bubble {
            padding: 15px 20px;
            background-color: var(--card-bg);
            border-radius: 18px;
            border-top-left-radius: 4px;
            display: flex;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: var(--primary);
            margin: 0 3px;
            animation: typing-bounce 1.4s infinite;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing-bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .input-container {
            padding: 15px 20px;
            border-top: 1px solid var(--border-color);
            display: flex;
            background-color: var(--sidebar-bg);
            backdrop-filter: blur(10px);
        }

        .message-input {
            flex: 1;
            padding: 12px 15px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            background-color: var(--input-bg);
            color: var(--foreground);
            resize: none;
            min-height: 50px;
            max-height: 150px;
            outline: none;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        .message-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(139, 92, 246, 0.2);
        }

        .send-button {
            width: 50px;
            height: 50px;
            border-radius: 8px;
            border: none;
            background: linear-gradient(to right, var(--primary), var(--primary-dark));
            color: white;
            margin-left: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .send-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(124, 58, 237, 0.4);
        }

        .send-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .sidebar-button {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            border-radius: 8px;
            background-color: transparent;
            color: var(--foreground);
            border: 1px solid var(--border-color);
            cursor: pointer;
            margin-bottom: 10px;
            transition: all 0.3s ease;
            width: 100%;
            text-align: left;
        }

        .sidebar-button:hover {
            background-color: rgba(139, 92, 246, 0.1);
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .sidebar-button i {
            margin-right: 10px;
        }

        /* Theme Toggle - Updated with icons */
        .theme-toggle {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 5px;
        }

        .theme-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background-color: var(--input-bg);
            color: var(--foreground);
            font-size: 1.2rem;
        }

        .theme-icon:hover {
            background-color: var(--primary);
            color: white;
            transform: scale(1.1);
        }

        .theme-icon.active {
            background-color: var(--primary);
            color: white;
            box-shadow: 0 0 10px rgba(139, 92, 246, 0.5);
        }

        .theme-icon:first-child {
            margin-right: 10px;
        }

        /* Chat History */
        .chat-history {
            margin-top: 20px;
        }

        .chat-history-title {
            font-size: 0.9rem;
            color: var(--muted-text);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }

        .chat-history-title i {
            margin-right: 8px;
        }

        .chat-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 15px;
            border-radius: 8px;
            background-color: var(--input-bg);
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .chat-item:hover {
            background-color: rgba(139, 92, 246, 0.1);
        }

        .chat-item.active {
            background-color: rgba(139, 92, 246, 0.2);
            border-left: 3px solid var(--primary);
        }

        .chat-item-title {
            font-size: 0.9rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 180px;
        }

        .chat-item-actions {
            display: flex;
            align-items: center;
        }

        .chat-item-action {
            background: none;
            border: none;
            color: var(--muted-text);
            cursor: pointer;
            font-size: 0.8rem;
            padding: 5px;
            transition: color 0.3s ease;
        }

        .chat-item-action:hover {
            color: var(--primary);
        }

        /* Toast Notification - Enhanced */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }

        .toast {
            background-color: var(--card-bg);
            color: var(--foreground);
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            animation: toast-in 0.5s ease, toast-out 0.5s ease 4.5s forwards;
            max-width: 300px;
            border-left: 4px solid var(--primary);
        }

        .toast i {
            margin-right: 10px;
            color: var(--primary);
        }

        @keyframes toast-in {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes toast-out {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }

        /* Modal Dialog */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 25px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            transform: translateY(20px);
            transition: transform 0.3s ease;
        }

        .modal-overlay.active .modal-content {
            transform: translateY(0);
        }

        .modal-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .modal-header i {
            color: var(--primary);
            font-size: 1.5rem;
            margin-right: 10px;
        }

        .modal-title {
            font-size: 1.2rem;
            font-weight: 600;
        }

        .modal-body {
            margin-bottom: 20px;
            color: var(--muted-text);
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
        }

        .modal-button {
            padding: 10px 15px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .modal-button.cancel {
            background-color: transparent;
            color: var(--muted-text);
            margin-right: 10px;
            border: 1px solid var(--border-color);
        }

        .modal-button.cancel:hover {
            background-color: rgba(148, 163, 184, 0.1);
        }

        .modal-button.confirm {
            background-color: var(--primary);
            color: white;
        }

        .modal-button.confirm:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(124, 58, 237, 0.4);
        }

        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                left: 0;
                top: 0;
                z-index: 100;
                transform: translateX(-100%);
                width: 80%;
                max-width: 300px;
            }

            .sidebar.active {
                transform: translateX(0);
            }

            .sidebar.collapsed {
                transform: translateX(-100%);
            }

            .welcome-title {
                font-size: 2rem;
            }

            .welcome-gradient {
                padding: 20px;
            }

            .message {
                max-width: 90%;
            }
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <img src="vexai.png" alt="VEX AI Logo" class="logo">
            <h1 class="app-title">VEX AI</h1>
        </div>
        <div class="sidebar-content">
            <button class="sidebar-button" id="new-chat-btn">
                <i class="fas fa-plus"></i> New Chat
            </button>
            
            <!-- Chat History Section -->
            <div class="chat-history">
                <div class="chat-history-title">
                    <i class="fas fa-history"></i> Chat History
                </div>
                <div id="chat-history-list">
                    <!-- Chat history items will be added here -->
                </div>
            </div>
        </div>
        <div class="sidebar-footer">
            <button class="sidebar-button" id="clear-chat-btn">
                <i class="fas fa-trash"></i> Clear Chat
            </button>
            
            <!-- Theme Toggle - Moved to bottom -->
            <div class="theme-toggle">
                <div class="theme-icon" id="dark-theme-btn" title="Dark Theme">
                    <i class="fas fa-moon"></i>
                </div>
                <div class="theme-icon" id="light-theme-btn" title="Light Theme">
                    <i class="fas fa-sun"></i>
                </div>
            </div>
            
            <div class="powered-by">
                <i class="fas fa-bolt"></i> Powered by Advanced AI and Aurora UI
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <div class="chat-header">
            <div class="header-left">
                <button class="toggle-sidebar" id="toggle-sidebar-btn">
                    <i class="fas fa-bars"></i>
                </button>
                <h2 class="chat-title" id="current-chat-title">Chat with VEX AI</h2>
            </div>
            <div class="header-right">
                <!-- Additional header elements can be added here -->
            </div>
        </div>

        <div class="chat-container" id="chat-container">
            <!-- Welcome Message (shown initially) -->
            <div class="welcome-container" id="welcome-container">
                <img src="vexai.png" alt="VEX AI" class="welcome-avatar">
                <div class="welcome-gradient">
                    <h1 class="welcome-title">Welcome to VEX AI</h1>
                    <p class="welcome-subtitle">Powered by Groq API for lightning-fast responses</p>
                    <p class="welcome-text">Ask me anything to get started!</p>
                </div>
                <div class="powered-by">
                    <i class="fas fa-bolt"></i> Powered by Advanced AI and Aurora UI
                </div>
            </div>

            <!-- Chat Messages will be added here -->
            <div id="messages-container" style="display: none;"></div>
        </div>

        <div class="input-container">
            <textarea 
                class="message-input" 
                id="message-input" 
                placeholder="Type your message..." 
                rows="1"
                onkeydown="if(event.key === 'Enter' && !event.shiftKey) { event.preventDefault(); sendMessage(); }"></textarea>
            <button class="send-button" id="send-button" disabled>
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toast-container"></div>
    
    <!-- Confirmation Modal -->
    <div class="modal-overlay" id="confirmation-modal">
        <div class="modal-content">
            <div class="modal-header">
                <i class="fas fa-exclamation-triangle"></i>
                <h3 class="modal-title">Confirm Action</h3>
            </div>
            <div class="modal-body" id="modal-message">
                Are you sure you want to perform this action?
            </div>
            <div class="modal-footer">
                <button class="modal-button cancel" id="modal-cancel">Cancel</button>
                <button class="modal-button confirm" id="modal-confirm">Confirm</button>
            </div>
        </div>
    </div>

    <script>
        // DOM Elements
        const sidebar = document.getElementById('sidebar');
        const toggleSidebarBtn = document.getElementById('toggle-sidebar-btn');
        const newChatBtn = document.getElementById('new-chat-btn');
        const clearChatBtn = document.getElementById('clear-chat-btn');
        const darkThemeBtn = document.getElementById('dark-theme-btn');
        const lightThemeBtn = document.getElementById('light-theme-btn');
        const welcomeContainer = document.getElementById('welcome-container');
        const messagesContainer = document.getElementById('messages-container');
        const chatContainer = document.getElementById('chat-container');
        const messageInput = document.getElementById('message-input');
        const sendButton = document.getElementById('send-button');
        const toastContainer = document.getElementById('toast-container');
        const chatHistoryList = document.getElementById('chat-history-list');
        const currentChatTitle = document.getElementById('current-chat-title');
        const confirmationModal = document.getElementById('confirmation-modal');
        const modalMessage = document.getElementById('modal-message');
        const modalCancel = document.getElementById('modal-cancel');
        const modalConfirm = document.getElementById('modal-confirm');

        // Hard-coded API key (replace this with your actual Groq API key)
        const apiKey = "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";

        // State
        let chats = [];
        let currentChatId = null;
        let isTyping = false;
        let darkMode = true;
        let currentController = null; // For aborting fetch requests
        let pendingAction = null; // For confirmation modal
        let welcomeMessages = [
            "Hello! I'm VEX AI. How can I assist you today?",
            "Welcome to VEX AI! What can I help you with?",
            "Hi there! I'm ready to help with any questions you might have.",
            "Greetings! How can VEX AI be of service today?",
            "Welcome! I'm your VEX AI assistant. What would you like to know?"
        ];

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            // Auto-resize textarea
            messageInput.addEventListener('input', autoResizeTextarea);
            
            // Enable/disable send button based on input
            messageInput.addEventListener('input', () => {
                sendButton.disabled = messageInput.value.trim() === '';
            });

            // Toggle sidebar
            toggleSidebarBtn.addEventListener('click', toggleSidebar);

            // New chat button
            newChatBtn.addEventListener('click', createNewChat);

            // Clear chat button
            clearChatBtn.addEventListener('click', () => {
                if (currentChatId) {
                    showConfirmationModal(
                        'Are you sure you want to clear this chat?',
                        () => clearCurrentChat()
                    );
                } else {
                    showToast('No active chat to clear', 'fa-info-circle');
                }
            });

            // Theme toggle
            darkThemeBtn.addEventListener('click', () => setTheme(true));
            lightThemeBtn.addEventListener('click', () => setTheme(false));
            
            // Send button
            sendButton.addEventListener('click', sendMessage);

            // Modal buttons
            modalCancel.addEventListener('click', hideConfirmationModal);
            modalConfirm.addEventListener('click', () => {
                if (pendingAction) {
                    pendingAction();
                    pendingAction = null;
                }
                hideConfirmationModal();
            });

            // Mobile detection for sidebar behavior
            if (window.innerWidth <= 768) {
                sidebar.classList.add('collapsed');
            }

            // Welcome gradient effect
            const welcomeGradient = document.querySelector('.welcome-gradient');
            welcomeGradient.addEventListener('mousemove', (e) => {
                const rect = welcomeGradient.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                welcomeGradient.style.setProperty('--x', `${x}px`);
                welcomeGradient.style.setProperty('--y', `${y}px`);
            });

            // Set initial theme
            updateThemeUI();

            // Load chats from local storage
            loadChats();
        });

        // Show Toast Notification
        function showToast(message, icon = 'fa-check-circle') {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.innerHTML = `<i class="fas ${icon}"></i> ${message}`;
            toastContainer.appendChild(toast);
            
            // Remove toast after animation completes
            setTimeout(() => {
                toast.remove();
            }, 5000);
        }

        // Toggle Sidebar
        function toggleSidebar() {
            if (window.innerWidth <= 768) {
                sidebar.classList.toggle('active');
            } else {
                sidebar.classList.toggle('collapsed');
            }
        }

        // Auto-resize textarea
        function autoResizeTextarea() {
            messageInput.style.height = 'auto';
            messageInput.style.height = (messageInput.scrollHeight) + 'px';
        }

        // Set Theme
        function setTheme(isDark) {
            darkMode = isDark;
            updateThemeUI();
            
            if (darkMode) {
                document.documentElement.style.setProperty('--background', 'var(--dark-background)');
                document.documentElement.style.setProperty('--foreground', 'var(--dark-foreground)');
                document.documentElement.style.setProperty('--card-bg', 'var(--dark-card-bg)');
                document.documentElement.style.setProperty('--border-color', 'var(--dark-border-color)');
                document.documentElement.style.setProperty('--muted-text', 'var(--dark-muted-text)');
                document.documentElement.style.setProperty('--sidebar-bg', 'var(--dark-sidebar-bg)');
                document.documentElement.style.setProperty('--input-bg', 'var(--dark-input-bg)');
                document.documentElement.style.setProperty('--aurora-opacity', '1');
            } else {
                document.documentElement.style.setProperty('--background', 'var(--light-background)');
                document.documentElement.style.setProperty('--foreground', 'var(--light-foreground)');
                document.documentElement.style.setProperty('--card-bg', 'var(--light-card-bg)');
                document.documentElement.style.setProperty('--border-color', 'var(--light-border-color)');
                document.documentElement.style.setProperty('--muted-text', 'var(--light-muted-text)');
                document.documentElement.style.setProperty('--sidebar-bg', 'var(--light-sidebar-bg)');
                document.documentElement.style.setProperty('--input-bg', 'var(--light-input-bg)');
                document.documentElement.style.setProperty('--aurora-opacity', '0.3');
            }
            
            showToast(`${darkMode ? 'Dark' : 'Light'} theme activated`, darkMode ? 'fa-moon' : 'fa-sun');
        }

        // Update Theme UI
        function updateThemeUI() {
            if (darkMode) {
                darkThemeBtn.classList.add('active');
                lightThemeBtn.classList.remove('active');
            } else {
                darkThemeBtn.classList.remove('active');
                lightThemeBtn.classList.add('active');
            }
        }

        // Show Confirmation Modal
        function showConfirmationModal(message, onConfirm) {
            modalMessage.textContent = message;
            pendingAction = onConfirm;
            confirmationModal.classList.add('active');
        }

        // Hide Confirmation Modal
        function hideConfirmationModal() {
            confirmationModal.classList.remove('active');
        }

        // Create New Chat
        function createNewChat() {
            const chatId = 'chat_' + Date.now();
            const chatTitle = `New Chat`;
            
            const newChat = {
                id: chatId,
                title: chatTitle,
                messages: [],
                createdAt: new Date().toISOString()
            };
            
            chats.push(newChat);
            saveChats();
            
            // Switch to the new chat
            switchChat(chatId);
            renderChatHistory();
            
            // Show welcome message in new chat
            displayWelcomeMessage();
            
            showToast('New chat created', 'fa-plus-circle');
        }

        // Display Welcome Message (not as an AI message)
        function displayWelcomeMessage() {
            if (currentChatId) {
                // Create a system message element
                const messageElement = document.createElement('div');
                messageElement.className = 'message system';
                
                const messageBubble = document.createElement('div');
                messageBubble.className = 'message-bubble';
                
                // Get random welcome message
                const welcomeMessage = welcomeMessages[Math.floor(Math.random() * welcomeMessages.length)];
                messageBubble.textContent = welcomeMessage;
                
                messageElement.appendChild(messageBubble);
                messagesContainer.appendChild(messageElement);
                
                // Scroll to bottom
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }
        }

        // Generate Smart Title
        function generateSmartTitle(message) {
            // If message is short enough, use it directly
            if (message.length <= 30) {
                return message;
            }
            
            // Try to extract a meaningful title
            // First, check if there's a question
            if (message.includes('?')) {
                const questionParts = message.split('?')[0].split(' ');
                if (questionParts.length > 3) {
                    return questionParts.slice(0, 5).join(' ') + '?';
                }
            }
            
            // Look for the first sentence
            const firstSentence = message.split(/[.!?]/)[0];
            if (firstSentence.length <= 40) {
                return firstSentence;
            }
            
            // If all else fails, take the first 30 chars
            return message.substring(0, 30) + '...';
        }

        // Switch Chat
        function switchChat(chatId) {
            currentChatId = chatId;
            const chat = chats.find(c => c.id === chatId);
            
            if (chat) {
                // Update UI
                currentChatTitle.textContent = chat.title;
                
                // Clear current messages
                messagesContainer.innerHTML = '';
                
                // Show messages container, hide welcome
                welcomeContainer.style.display = 'none';
                messagesContainer.style.display = 'block';
                
                // If no messages, show welcome message
                if (chat.messages.length === 0) {
                    displayWelcomeMessage();
                } else {
                    // Render messages
                    chat.messages.forEach(msg => {
                        renderMessage(msg.content, msg.role);
                    });
                }
                
                // Update active chat in history
                document.querySelectorAll('.chat-item').forEach(item => {
                    item.classList.remove('active');
                    if (item.dataset.id === chatId) {
                        item.classList.add('active');
                    }
                });
            }
        }

        // Delete Chat
        function deleteChat(chatId) {
            showConfirmationModal(
                'Are you sure you want to delete this chat?',
                () => {
                    chats = chats.filter(c => c.id !== chatId);
                    saveChats();
                    renderChatHistory();
                    
                    // If current chat was deleted
                    if (currentChatId === chatId) {
                        if (chats.length > 0) {
                            switchChat(chats[0].id);
                        } else {
                            currentChatId = null;
                            welcomeContainer.style.display = 'flex';
                            messagesContainer.style.display = 'none';
                            currentChatTitle.textContent = 'Chat with VEX AI';
                        }
                    }
                    
                    showToast('Chat deleted successfully', 'fa-trash');
                }
            );
        }

        // Clear Current Chat
        function clearCurrentChat() {
            if (!currentChatId) return;
            
            const chatIndex = chats.findIndex(c => c.id === currentChatId);
            if (chatIndex !== -1) {
                chats[chatIndex].messages = [];
                chats[chatIndex].title = "New Chat";
                currentChatTitle.textContent = "New Chat";
                saveChats();
                
                // Clear UI
                messagesContainer.innerHTML = '';
                
                // Show welcome message in cleared chat
                displayWelcomeMessage();
                
                // Update chat history to reflect title change
                renderChatHistory();
                
                showToast('Chat cleared successfully', 'fa-eraser');
            }
        }

        // Render Chat History
        function renderChatHistory() {
            chatHistoryList.innerHTML = '';
            
            if (chats.length === 0) {
                const emptyState = document.createElement('div');
                emptyState.className = 'chat-history-title';
                emptyState.style.textAlign = 'center';
                emptyState.style.padding = '10px';
                emptyState.textContent = 'No chats yet';
                chatHistoryList.appendChild(emptyState);
                return;
            }
            
            // Sort chats by creation date (newest first)
            const sortedChats = [...chats].sort((a, b) => 
                new Date(b.createdAt) - new Date(a.createdAt)
            );
            
            sortedChats.forEach(chat => {
                const chatItem = document.createElement('div');
                chatItem.className = `chat-item ${chat.id === currentChatId ? 'active' : ''}`;
                chatItem.dataset.id = chat.id;
                
                const chatTitle = document.createElement('div');
                chatTitle.className = 'chat-item-title';
                chatTitle.textContent = chat.title;
                
                const chatActions = document.createElement('div');
                chatActions.className = 'chat-item-actions';
                
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'chat-item-action';
                deleteBtn.innerHTML = '<i class="fas fa-trash"></i>';
                deleteBtn.title = 'Delete chat';
                deleteBtn.onclick = (e) => {
                    e.stopPropagation();
                    deleteChat(chat.id);
                };
                
                chatActions.appendChild(deleteBtn);
                chatItem.appendChild(chatTitle);
                chatItem.appendChild(chatActions);
                
                chatItem.addEventListener('click', () => {
                    switchChat(chat.id);
                });
                
                chatHistoryList.appendChild(chatItem);
            });
        }

        // Render Message
        function renderMessage(content, role) {
            const messageElement = document.createElement('div');
            messageElement.className = `message ${role === 'user' ? 'user' : 'ai'}`;
            
            const avatarContainer = document.createElement('div');
            avatarContainer.className = 'avatar';
            
            if (role === 'user') {
                // User avatar with icon
                avatarContainer.innerHTML = '<i class="fas fa-user"></i>';
            } else {
                // AI avatar with image
                const avatarImg = document.createElement('img');
                avatarImg.src = 'vexai.png';
                avatarImg.alt = 'VEX AI';
                avatarContainer.appendChild(avatarImg);
            }
            
            const messageBubble = document.createElement('div');
            messageBubble.className = 'message-bubble';
            messageBubble.textContent = content;
            
            messageElement.appendChild(avatarContainer);
            messageElement.appendChild(messageBubble);
            messagesContainer.appendChild(messageElement);
            
            // Scroll to bottom
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        // Add Typing Indicator
        function addTypingIndicator() {
            const typingElement = document.createElement('div');
            typingElement.className = 'typing-indicator';
            typingElement.id = 'typing-indicator';
            
            const avatarContainer = document.createElement('div');
            avatarContainer.className = 'avatar';
            
            const avatarImg = document.createElement('img');
            avatarImg.src = 'vexai.png';
            avatarImg.alt = 'VEX AI';
            avatarContainer.appendChild(avatarImg);
            
            const typingBubble = document.createElement('div');
            typingBubble.className = 'typing-bubble';
            
            for (let i = 0; i < 3; i++) {
                const dot = document.createElement('div');
                dot.className = 'typing-dot';
                typingBubble.appendChild(dot);
            }
            
            typingElement.appendChild(avatarContainer);
            typingElement.appendChild(typingBubble);
            messagesContainer.appendChild(typingElement);
            
            // Scroll to bottom
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        // Remove Typing Indicator
        function removeTypingIndicator() {
            const typingIndicator = document.getElementById('typing-indicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }

        // Send Message
        async function sendMessage() {
            const message = messageInput.value.trim();
            if (message === '' || isTyping) return;
            
            // Create new chat if none exists
            if (!currentChatId) {
                createNewChat();
            }
            
            // Reset input
            messageInput.value = '';
            messageInput.style.height = 'auto';
            sendButton.disabled = true;
            
            // Add user message to UI
            renderMessage(message, 'user');
            
            // Add user message to chat
            const chatIndex = chats.findIndex(c => c.id === currentChatId);
            if (chatIndex !== -1) {
                chats[chatIndex].messages.push({ content: message, role: 'user' });
                
                // Update chat title if it's the first user message
                if (chats[chatIndex].messages.filter(m => m.role === 'user').length === 1) {
                    // Generate smart title
                    const smartTitle = generateSmartTitle(message);
                    chats[chatIndex].title = smartTitle;
                    currentChatTitle.textContent = smartTitle;
                    renderChatHistory();
                }
                
                saveChats();
            }
            
            // Show typing indicator
            addTypingIndicator();
            isTyping = true;
            
            try {
                // Cancel any ongoing request
                if (currentController) {
                    currentController.abort();
                }
                
                // Create new AbortController
                currentController = new AbortController();
                const signal = currentController.signal;
                
                // Prepare messages for the API
                const messageArray = chats[chatIndex].messages.map(msg => ({
                    role: msg.role === 'ai' ? 'assistant' : msg.role,
                    content: msg.content
                }));
                
                // Add system message for VEX AI's personality
                messageArray.unshift({
                    role: "system",
                    content: "You are VEX AI, a helpful, intelligent, and friendly AI assistant powered by Groq. You provide concise, accurate, and thoughtful responses. You have expertise in many areas including technology, science, arts, history, and more. Your goal is to provide users with helpful information and assist them with their tasks. You can be conversational but focus on delivering value to the user's requests."
                });
                
                // Call Groq API
                const response = await fetch('https://api.groq.com/openai/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: 'llama3-70b-8192',
                        messages: messageArray,
                        temperature: 0.7,
                        max_tokens: 4096
                    }),
                    signal
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error?.message || 'Failed to get response');
                }
                
                const data = await response.json();
                const aiResponse = data.choices[0].message.content;
                
                // Remove typing indicator and add AI response
                removeTypingIndicator();
                renderMessage(aiResponse, 'ai');
                
                // Add AI response to chat
                if (chatIndex !== -1) {
                    chats[chatIndex].messages.push({ content: aiResponse, role: 'ai' });
                    saveChats();
                }
                
            } catch (error) {
                if (error.name === 'AbortError') {
                    console.log('Request was aborted');
                } else {
                    console.error('Error:', error);
                    removeTypingIndicator();
                    showToast(`Error: ${error.message}`, 'fa-exclamation-circle');
                }
            } finally {
                isTyping = false;
                currentController = null;
            }
        }

        // Save Chats to Local Storage
        function saveChats() {
            localStorage.setItem('vex-ai-chats', JSON.stringify(chats));
        }

        // Load Chats from Local Storage
        function loadChats() {
            const savedChats = localStorage.getItem('vex-ai-chats');
            if (savedChats) {
                chats = JSON.parse(savedChats);
                renderChatHistory();
                
                // Load last active chat if any
                if (chats.length > 0) {
                    switchChat(chats[0].id);
                }
            }
        }

        // Handle window resize
        window.addEventListener('resize', () => {
            if (window.innerWidth <= 768) {
                sidebar.classList.add('collapsed');
                sidebar.classList.remove('active');
            } else {
                sidebar.classList.remove('collapsed');
            }
        });
    </script>
</body>
</html>
